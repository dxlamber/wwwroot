<!DOCTYPE html>
<html>
<head>
	<title>An Lisp interpretation by Javascript</title>
	<meta charset="UTF-8">
	<link href="/lib/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
</head>
<body>
 <p>Test Lisp Expression:</p>
 <div><textarea id="simpleExp" style="height:100px; width:300px;">(+ 12 23)</textarea></div>
 <div><button onclick="calcSimpleExp();">计算</button></div>
</body>
<script src="/lib/jquery/jquery.js"></script>
<script src="/lib/bootstrap/js/bootstrap.js"></script>
<script src="utils.js"></script>
<script src="autofsm.js"></script>
<script src="computeobj.js"></script>
<script type="text/javascript">
var GlobalEnv = {};
GlobalEnv["+"] = function(){
 return [].reduce.call(arguments, function(pv, cv){return pv+cv;}, 0);
};
GlobalEnv["*"] = function(){
 debugger;
 return [].reduce.call(arguments, function(pv, cv){return pv*cv;}, 1);
};
GlobalEnv["-"] = function(){
 if(arguments.length != 2)
 {
	debugger;
	return;
 }
	
 return arguments[0] - arguments[1];
};
GlobalEnv["/"] = function(){
 if(arguments.length != 2)
 {
	debugger;
	return;
 }
	
 return arguments[0] / arguments[1];
};
GlobalEnv.note = function(obj){
 return obj.toNote();
};
</script>

<script type="text/javascript">
function createTree(wordArr)
{
	var gCurPos = 0;
	
	var startExp = function()
	{
		var tmpObj = null;
		var paraArr = [];
		for(; gCurPos < wordArr.length; gCurPos ++)
		{
			var curWord = wordArr[gCurPos];
			switch(curWord.type)
			{
				case "BracketStart": 
					gCurPos = gCurPos + 1;//the "(" is processed, go next character.
					paraArr.push(startExp());
					break;
				case "BracketEnd":
					return (new Exp(paraArr));
					break;
				case "Number":
				case "String":
				case "Label":
				case "FourOperator":
					paraArr.push(new Atom(wordArr[gCurPos].type, wordArr[gCurPos].val));
					break;
				default: 
					console.log("Error syntax!!!")
					break;
			}
		}
		
	};
	
	
	gCurPos = 0;
	var tmpObj = null;
	if(wordArr[0].type === "BracketStart")
	{
		gCurPos = 1;
		tmpObj = startExp();
	}
	else
		tmpObj = new Atom(wordArr[gCurPos].type, wordArr[gCurPos].val);
			
	console.log(tmpObj);
	return tmpObj;
};


function getList(startPos, wordArr)
{
	var tmpList = null;
	tmpList = new Exp();
	return tmpList;
};
function getAtom(startPos, wordArr)
{
	return new Atom(wordArr[0].val);
};

function calcSimpleExp()
{
	/*var str = $("#simpleExp").val();
	var inputL = str.split('\n').pop();
	var v = (inputL[0] == '(' ? new Exp(inputL) : new Atom(inputL));
	$("#simpleExp").val(str + "\n" + v.getVal());*/
	
	debugger;
	
	var strLisp = '(* 3 (- 4 2))';
	var blockArr = LispAutoFsm.removeSeparator(LispAutoFsm.parseWord(strLisp));
	debugger;
	var treeRootRef = createTree(blockArr);
	debugger;
};
</script>
</html>